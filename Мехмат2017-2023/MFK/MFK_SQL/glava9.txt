Токаева Александра, мехмат, 3 курс, 03.05.20
Дз по главе 9

2)Задание. Модифицируйте сценарий выполнения транзакций: в первой тран- закции вместо фиксации изменений выполните их отмену с помощью команды ROLLBACK и посмотрите, будет ли удалена строка и какая конкретно.

На 1 терминале:

demo=# begin;
BEGIN
demo=# SELECT *
demo-# FROM aircrafts_tmp WHERE range < 2000;
 aircraft_code |       model        | range | specifications 
---------------+--------------------+-------+----------------
 CN1           | Cessna 208 Caravan |  1200 | 
(1 row)

demo=# 
demo=# UPDATE aircrafts_tmp
demo-# SET range = 2100
demo-# WHERE aircraft_code = 'CN1';
UPDATE 1
demo=# 
demo=# 
demo=# UPDATE aircrafts_tmp
demo-# SET range = 1900
demo-# WHERE aircraft_code = 'CR2';
UPDATE 1

На втором терминале:

demo=# begin;
BEGIN
demo=# SELECT *
demo-# FROM aircrafts_tmp WHERE range < 2000;
 aircraft_code |       model        | range | specifications 
---------------+--------------------+-------+----------------
 CN1           | Cessna 208 Caravan |  1200 | 
(1 row)

demo=# DELETE FROM aircrafts_tmp WHERE range < 2000;

DELETE 1


На 1 терминале:

demo=# 
demo=# rollback;
ROLLBACK


На 2 терминале:

demo=# select * from aircrafts_tmp ;
 aircraft_code |        model        | range |                     specifications                      
---------------+---------------------+-------+---------------------------------------------------------
 773           | Boeing 777-300      | 11100 | 
 763           | Boeing 767-300      |  7900 | 
 321           | Airbus A321-200     |  5600 | 
 319           | Airbus A319-100     |  6700 | 
 733           | Boeing 737-300      |  4200 | 
 CR2           | Bombardier CRJ-200  |  2700 | 
 320           | Airbus A320-200     |  5700 | {"crew": 2, "engines": {"num": 2, "type": "IAE V2500"}}
 SU9           | Sukhoi SuperJet-100 |  3300 | 
(8 rows)


Мы видим , что строка с CN1 была удалена, а изменения в строке CN2 не видны;\


3) Когда говорят о таком феномене, как потерянное обновление, то зачастую в качестве примера приводится операция UPDATE, в которой значение какого-то атрибута изменяется с применением одного из действий арифметики. Напри- мер:
UPDATE aircrafts_tmp
SET range = range + 200 WHERE aircraft_code = 'CR2';
При выполнении двух и более подобных обновлений в рамках параллельных транзакций, использующих, например, уровень изоляции Read Committed, будут учтены все такие изменения (что и было показано в тексте главы). Очевидно, что потерянного обновления не происходит.
Предположим, что в одной транзакции будет просто присваиваться новое значение, например, так:
UPDATE aircrafts_tmp
SET range = 2100
WHERE aircraft_code = 'CR2';
А в параллельной транзакции будет выполняться аналогичная команда:
UPDATE aircrafts_tmp
SET range = 2500
WHERE aircraft_code = 'CR2';


Очевидно, что сохранится только одно из значений атрибута range. Можно ли говорить, что в такой ситуации имеет место потерянное обновление? Если оно имеет место, то что можно предпринять для его недопущения? Обоснуйте ваш ответ.


Мне кажется, что в некоторых ситуациях это  может оказаться потерянным обновлением; потому что мы принимали решение о присвоении значения 2100 (или 2500) основываясь на старых данных (где range = 1200) , то есть если бы мы в момент принятия решения от присвоении значения 2500 видели обновленное значение 2100, то мы бы может и не захотели менять 2100 на 2500; поэтому в такой ситуации мы потеряли данные;